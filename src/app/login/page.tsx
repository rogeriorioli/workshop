"use client";
import Link from "next/link";
import style from "./styles.module.css";
import React, { FormEvent, useRef, useState } from "react";
import Message, { MessageProps } from "../components/Message";
import axios from "axios";
import Authenticated from "../helpers/Authenticated";

const Login = () => {
  const [message, setMessage] = useState<MessageProps>();
  const emailRef = useRef<HTMLInputElement | null>(null);
  const handleFormSubmit = async (e: FormEvent) => {
    e.preventDefault();

    const data = {
      email: emailRef.current?.value,
    };

    if (emailRef.current?.value !== "") {
      const subscriber = await axios
        .post("/api/signin", data)
        .then((success) => {
          const { data } = success;
          const localStorageData = JSON.stringify({
            id: data.id,
            name: data.name,
          });
          window.localStorage.setItem("user", localStorageData);
          setMessage({
            messsage: data.message,
            cssClass: "text-green-900 bg-green-100 border-green-400",
          });
        })
        .catch((err) => {
          const { message } = err.response.data;
          setMessage({
            messsage: message,
            cssClass: "text-red-900 bg-red-100 border-red-400",
          });
        });
    } else {
      setMessage({
        messsage: "Os campos devem ser preenchidos",
        cssClass: "text-red-900 bg-red-100 border-red-400",
      });
    }
  };
  return (
    <Authenticated>
      <main
        className={`${style.bgLogin} flex justify-center items-center min-h-screen w-full flex-row `}
      >
        <div className="container flex flex-col lg:flex-row justify-center">
          <div className="lg-w-1/2 flex justify-center items-center">
            <div className="flex-col ">
              <div className="logo mb-10 ">
                <div>
                  <a href="https://designhope.com.br" target="_blank">
                    <svg
                      width="185"
                      height="62"
                      viewBox="0 0 185 62"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M35.1444 6H6V60.8812C14.3529 60.9708 32.9653 61.0964 40.5919 60.8812C48.2185 60.6659 51.2146 52.0033 51.7594 47.6989C51.941 42.9461 52.1952 31.127 51.7594 21.8725C51.3236 12.618 40.5919 6 35.1444 6Z"
                        stroke="black"
                        strokeWidth="2"
                      />
                      <path
                        d="M29.5108 1H1V55.8812C9.17132 55.9708 27.3791 56.0964 34.8399 55.8812C42.3007 55.6659 45.2317 47.0033 45.7646 42.6989C45.9422 37.9461 46.1909 26.127 45.7646 16.8725C45.3383 7.61802 34.8399 1 29.5108 1Z"
                        stroke="black"
                        strokeWidth="2"
                      />
                      <path
                        d="M59.92 37.043C59.92 35.9083 60.15 34.8733 60.61 33.938C61.0853 32.9873 61.737 32.2283 62.565 31.661C63.393 31.0937 64.336 30.81 65.394 30.81C66.3907 30.81 67.28 31.0783 68.062 31.615C68.8593 32.1363 69.4803 32.7727 69.925 33.524V26.21H71.489V41.114C71.489 41.3287 71.535 41.4897 71.627 41.597C71.719 41.689 71.857 41.7427 72.041 41.758V43C71.7343 43.046 71.4967 43.0613 71.328 43.046C71.006 43.0307 70.7223 42.9003 70.477 42.655C70.2317 42.4097 70.109 42.1413 70.109 41.85V40.677C69.6337 41.459 68.9897 42.08 68.177 42.54C67.3643 43 66.521 43.23 65.647 43.23C64.819 43.23 64.0523 43.0613 63.347 42.724C62.657 42.3867 62.0513 41.9267 61.53 41.344C61.024 40.7613 60.6253 40.102 60.334 39.366C60.058 38.6147 59.92 37.8403 59.92 37.043ZM69.925 38.883V35.18C69.7257 34.628 69.4037 34.1297 68.959 33.685C68.5143 33.225 68.0083 32.8647 67.441 32.604C66.889 32.328 66.337 32.19 65.785 32.19C65.141 32.19 64.5583 32.328 64.037 32.604C63.5157 32.8647 63.0633 33.225 62.68 33.685C62.312 34.145 62.0283 34.6663 61.829 35.249C61.6297 35.8317 61.53 36.4297 61.53 37.043C61.53 37.687 61.6373 38.3003 61.852 38.883C62.082 39.4657 62.404 39.987 62.818 40.447C63.232 40.8917 63.7073 41.2367 64.244 41.482C64.7807 41.7273 65.3633 41.85 65.992 41.85C66.3907 41.85 66.8047 41.7733 67.234 41.62C67.6633 41.4667 68.0697 41.2597 68.453 40.999C68.8517 40.723 69.1813 40.401 69.442 40.033C69.7027 39.665 69.8637 39.2817 69.925 38.883ZM80.2076 43.23C79.349 43.23 78.5516 43.069 77.8156 42.747C77.0796 42.4097 76.4433 41.9573 75.9066 41.39C75.37 40.8073 74.9483 40.1403 74.6416 39.389C74.3503 38.6377 74.2046 37.8327 74.2046 36.974C74.2046 35.8547 74.4576 34.8273 74.9636 33.892C75.485 32.9567 76.198 32.213 77.1026 31.661C78.0073 31.0937 79.0346 30.81 80.1846 30.81C81.3653 30.81 82.3926 31.0937 83.2666 31.661C84.156 32.2283 84.8536 32.9797 85.3596 33.915C85.8656 34.835 86.1186 35.847 86.1186 36.951C86.1186 37.0737 86.1186 37.1963 86.1186 37.319C86.1186 37.4263 86.111 37.5107 86.0956 37.572H75.8376C75.9143 38.4307 76.152 39.1973 76.5506 39.872C76.9646 40.5313 77.4936 41.0603 78.1376 41.459C78.797 41.8423 79.51 42.034 80.2766 42.034C81.0586 42.034 81.7946 41.8347 82.4846 41.436C83.19 41.0373 83.6806 40.516 83.9566 39.872L85.3136 40.24C85.0683 40.8073 84.6926 41.321 84.1866 41.781C83.6806 42.241 83.0826 42.6013 82.3926 42.862C81.718 43.1073 80.9896 43.23 80.2076 43.23ZM75.7916 36.445H84.6466C84.5853 35.571 84.3476 34.8043 83.9336 34.145C83.535 33.4857 83.006 32.972 82.3466 32.604C81.7026 32.2207 80.9896 32.029 80.2076 32.029C79.4256 32.029 78.7126 32.2207 78.0686 32.604C77.4246 32.972 76.8956 33.4933 76.4816 34.168C76.083 34.8273 75.853 35.5863 75.7916 36.445ZM92.4646 43.23C91.4833 43.23 90.571 43.069 89.7276 42.747C88.8843 42.425 88.156 41.9343 87.5426 41.275L88.1866 40.171C88.8613 40.7997 89.536 41.2597 90.2106 41.551C90.9006 41.827 91.629 41.965 92.3956 41.965C93.331 41.965 94.09 41.781 94.6726 41.413C95.2553 41.0297 95.5466 40.4853 95.5466 39.78C95.5466 39.3047 95.401 38.9443 95.1096 38.699C94.8336 38.4383 94.4273 38.2313 93.8906 38.078C93.3693 37.9093 92.7406 37.733 92.0046 37.549C91.1766 37.319 90.479 37.0813 89.9116 36.836C89.3596 36.5753 88.938 36.2533 88.6466 35.87C88.3706 35.4713 88.2326 34.9577 88.2326 34.329C88.2326 33.547 88.4243 32.903 88.8076 32.397C89.2063 31.8757 89.743 31.4847 90.4176 31.224C91.1076 30.948 91.8743 30.81 92.7176 30.81C93.6376 30.81 94.4503 30.9557 95.1556 31.247C95.861 31.5383 96.436 31.9447 96.8806 32.466L96.1216 33.524C95.6923 33.0333 95.1786 32.673 94.5806 32.443C93.998 32.1977 93.3463 32.075 92.6256 32.075C92.135 32.075 91.6673 32.144 91.2226 32.282C90.778 32.4047 90.41 32.6193 90.1186 32.926C89.8426 33.2173 89.7046 33.6237 89.7046 34.145C89.7046 34.5743 89.812 34.9117 90.0266 35.157C90.2413 35.387 90.5633 35.5863 90.9926 35.755C91.422 35.9083 91.951 36.077 92.5796 36.261C93.4843 36.5063 94.274 36.7593 94.9486 37.02C95.6233 37.2653 96.1446 37.5873 96.5126 37.986C96.8806 38.3847 97.0646 38.9443 97.0646 39.665C97.0646 40.7843 96.643 41.6583 95.7996 42.287C94.9563 42.9157 93.8446 43.23 92.4646 43.23ZM99.6498 43V31.017H101.214V43H99.6498ZM99.6498 28.51V26.21H101.214V28.51H99.6498ZM109.466 43.161C108.653 43.161 107.902 42.9923 107.212 42.655C106.522 42.3177 105.924 41.8653 105.418 41.298C104.927 40.7153 104.544 40.056 104.268 39.32C103.992 38.584 103.854 37.825 103.854 37.043C103.854 36.1997 103.984 35.41 104.245 34.674C104.521 33.9227 104.904 33.2557 105.395 32.673C105.901 32.0903 106.491 31.638 107.166 31.316C107.84 30.9787 108.592 30.81 109.42 30.81C110.447 30.81 111.336 31.0707 112.088 31.592C112.854 32.1133 113.498 32.7573 114.02 33.524V31.017H115.423V43.046C115.423 44.15 115.154 45.0777 114.618 45.829C114.096 46.5957 113.383 47.1707 112.479 47.554C111.589 47.9373 110.616 48.129 109.558 48.129C108.193 48.129 107.089 47.8837 106.246 47.393C105.402 46.9023 104.712 46.243 104.176 45.415L105.142 44.656C105.617 45.4073 106.246 45.967 107.028 46.335C107.825 46.703 108.668 46.887 109.558 46.887C110.34 46.887 111.053 46.7413 111.697 46.45C112.356 46.174 112.877 45.7523 113.261 45.185C113.659 44.6177 113.859 43.9047 113.859 43.046V40.677C113.399 41.4283 112.77 42.034 111.973 42.494C111.175 42.9387 110.34 43.161 109.466 43.161ZM109.903 41.85C110.378 41.85 110.83 41.7657 111.26 41.597C111.704 41.4283 112.111 41.206 112.479 40.93C112.847 40.6387 113.153 40.3167 113.399 39.964C113.644 39.6113 113.797 39.251 113.859 38.883V35.18C113.629 34.5973 113.299 34.0837 112.87 33.639C112.44 33.179 111.95 32.8263 111.398 32.581C110.861 32.3203 110.301 32.19 109.719 32.19C109.044 32.19 108.438 32.3357 107.902 32.627C107.38 32.903 106.936 33.2787 106.568 33.754C106.215 34.214 105.939 34.7353 105.74 35.318C105.54 35.9007 105.441 36.4833 105.441 37.066C105.441 37.71 105.556 38.3233 105.786 38.906C106.016 39.4733 106.33 39.987 106.729 40.447C107.143 40.8917 107.618 41.2367 108.155 41.482C108.707 41.7273 109.289 41.85 109.903 41.85ZM128.95 43H127.386V36.307C127.386 34.8963 127.179 33.869 126.765 33.225C126.351 32.5657 125.7 32.236 124.81 32.236C124.197 32.236 123.591 32.3893 122.993 32.696C122.395 32.9873 121.866 33.3937 121.406 33.915C120.962 34.421 120.64 35.0037 120.44 35.663V43H118.876V31.017H120.302V33.731C120.624 33.1483 121.046 32.6423 121.567 32.213C122.089 31.7683 122.679 31.4233 123.338 31.178C123.998 30.9327 124.68 30.81 125.385 30.81C126.045 30.81 126.604 30.9327 127.064 31.178C127.524 31.4233 127.892 31.776 128.168 32.236C128.444 32.6807 128.644 33.225 128.766 33.869C128.889 34.4977 128.95 35.203 128.95 35.985V43ZM142.36 43H140.796V36.307C140.796 34.9577 140.558 33.9457 140.083 33.271C139.607 32.581 138.925 32.236 138.036 32.236C137.453 32.236 136.87 32.3893 136.288 32.696C135.72 32.9873 135.214 33.3937 134.77 33.915C134.34 34.421 134.034 35.0037 133.85 35.663V43H132.286V26.21H133.85V33.731C134.325 32.8417 134.984 32.1363 135.828 31.615C136.686 31.0783 137.599 30.81 138.565 30.81C139.255 30.81 139.837 30.9327 140.313 31.178C140.803 31.4233 141.194 31.7837 141.486 32.259C141.792 32.719 142.015 33.2633 142.153 33.892C142.291 34.5053 142.36 35.203 142.36 35.985V43ZM150.801 43.23C149.942 43.23 149.145 43.069 148.409 42.747C147.688 42.4097 147.059 41.9573 146.523 41.39C146.001 40.8073 145.595 40.148 145.304 39.412C145.012 38.6607 144.867 37.871 144.867 37.043C144.867 36.1843 145.012 35.387 145.304 34.651C145.595 33.8997 146.009 33.2403 146.546 32.673C147.082 32.0903 147.711 31.638 148.432 31.316C149.168 30.9787 149.965 30.81 150.824 30.81C151.682 30.81 152.472 30.9787 153.193 31.316C153.913 31.638 154.542 32.0903 155.079 32.673C155.615 33.2403 156.029 33.8997 156.321 34.651C156.612 35.387 156.758 36.1843 156.758 37.043C156.758 37.871 156.612 38.6607 156.321 39.412C156.029 40.148 155.615 40.8073 155.079 41.39C154.557 41.9573 153.929 42.4097 153.193 42.747C152.472 43.069 151.675 43.23 150.801 43.23ZM146.454 37.066C146.454 37.9553 146.645 38.768 147.029 39.504C147.427 40.2247 147.956 40.7997 148.616 41.229C149.275 41.643 150.003 41.85 150.801 41.85C151.598 41.85 152.326 41.6353 152.986 41.206C153.645 40.7767 154.174 40.194 154.573 39.458C154.971 38.7067 155.171 37.894 155.171 37.02C155.171 36.1307 154.971 35.318 154.573 34.582C154.174 33.846 153.645 33.2633 152.986 32.834C152.326 32.4047 151.598 32.19 150.801 32.19C150.003 32.19 149.275 32.4123 148.616 32.857C147.972 33.3017 147.45 33.892 147.052 34.628C146.653 35.3487 146.454 36.1613 146.454 37.066ZM165.491 43.23C164.495 43.23 163.598 42.9693 162.8 42.448C162.018 41.9267 161.397 41.2827 160.937 40.516V47.899H159.373V31.017H160.776V33.34C161.252 32.5887 161.888 31.983 162.685 31.523C163.483 31.0477 164.334 30.81 165.238 30.81C166.066 30.81 166.825 30.9863 167.515 31.339C168.205 31.6763 168.803 32.1363 169.309 32.719C169.815 33.3017 170.206 33.9687 170.482 34.72C170.774 35.456 170.919 36.2227 170.919 37.02C170.919 38.1393 170.689 39.1743 170.229 40.125C169.785 41.0603 169.156 41.8117 168.343 42.379C167.531 42.9463 166.58 43.23 165.491 43.23ZM165.054 41.85C165.714 41.85 166.304 41.7197 166.825 41.459C167.347 41.183 167.791 40.815 168.159 40.355C168.543 39.895 168.834 39.3813 169.033 38.814C169.233 38.2313 169.332 37.6333 169.332 37.02C169.332 36.376 169.217 35.7627 168.987 35.18C168.773 34.5973 168.458 34.0837 168.044 33.639C167.63 33.1943 167.155 32.8417 166.618 32.581C166.082 32.3203 165.499 32.19 164.87 32.19C164.472 32.19 164.058 32.2667 163.628 32.42C163.199 32.5733 162.785 32.7957 162.386 33.087C162.003 33.363 161.681 33.6773 161.42 34.03C161.16 34.3827 160.999 34.7583 160.937 35.157V38.837C161.183 39.4043 161.512 39.918 161.926 40.378C162.34 40.8227 162.816 41.183 163.352 41.459C163.904 41.7197 164.472 41.85 165.054 41.85ZM178.744 43.23C177.885 43.23 177.088 43.069 176.352 42.747C175.616 42.4097 174.979 41.9573 174.443 41.39C173.906 40.8073 173.484 40.1403 173.178 39.389C172.886 38.6377 172.741 37.8327 172.741 36.974C172.741 35.8547 172.994 34.8273 173.5 33.892C174.021 32.9567 174.734 32.213 175.639 31.661C176.543 31.0937 177.571 30.81 178.721 30.81C179.901 30.81 180.929 31.0937 181.803 31.661C182.692 32.2283 183.39 32.9797 183.896 33.915C184.402 34.835 184.655 35.847 184.655 36.951C184.655 37.0737 184.655 37.1963 184.655 37.319C184.655 37.4263 184.647 37.5107 184.632 37.572H174.374C174.45 38.4307 174.688 39.1973 175.087 39.872C175.501 40.5313 176.03 41.0603 176.674 41.459C177.333 41.8423 178.046 42.034 178.813 42.034C179.595 42.034 180.331 41.8347 181.021 41.436C181.726 41.0373 182.217 40.516 182.493 39.872L183.85 40.24C183.604 40.8073 183.229 41.321 182.723 41.781C182.217 42.241 181.619 42.6013 180.929 42.862C180.254 43.1073 179.526 43.23 178.744 43.23ZM174.328 36.445H183.183C183.121 35.571 182.884 34.8043 182.47 34.145C182.071 33.4857 181.542 32.972 180.883 32.604C180.239 32.2207 179.526 32.029 178.744 32.029C177.962 32.029 177.249 32.2207 176.605 32.604C175.961 32.972 175.432 33.4933 175.018 34.168C174.619 34.8273 174.389 35.5863 174.328 36.445Z"
                        fill="black"
                      />
                    </svg>
                  </a>
                </div>
              </div>
              <h2 className="text-2xl font-bold tracking-tight text-black sm:text-5xl">
                Workshop Mão na massa!
              </h2>
              <p className="mt-6 text-lg leading-8 text-gray-900">
                Desenvolvendo LandingPages com Next Js, Prisma e persistindo{" "}
                <br />
                todos os dados dos Leads com PostgresSql
              </p>
            </div>
          </div>
          <div className="lg:w-1/2 flex justify-center items-center ">
            <div className="flex justify-center flex-col bg-white font-semibold rounded-md px-4 lg:w-[420px] min-h-[350px] border-solid border-2 border-black">
              <form onSubmit={handleFormSubmit}>
                <h2 className="text-blaack text-2xl">Entre com seu email</h2>
                <p className="text-black-90">O mesmo usado na inscrição </p>
                <div className="mb-3 border-2 border-gray-400 rounded-md focus-within:border-gray-900 my-4">
                  <input
                    name="email"
                    type="email"
                    ref={emailRef}
                    placeholder="email@servidor.com.br"
                    className="w-full p-2 outline-0 focus:outline-none rounded-md "
                  />
                </div>
                <div>
                  <button
                    type="submit"
                    className="bg-gray-900 hover:bg-gray-700 transition-all text-white font-semibold uppercase text-center p-4 w-full"
                  >
                    Entrar
                  </button>
                  <p className="font-thin mt-1">
                    não se inscreveu ?{" "}
                    <Link href="/" className="font-semibold">
                      clique aqui
                    </Link>
                  </p>
                </div>
                {message && (
                  <Message
                    messsage={message.messsage}
                    cssClass={message.cssClass}
                  />
                )}
              </form>
            </div>
          </div>
        </div>
      </main>
    </Authenticated>
  );
};

export default Login;
